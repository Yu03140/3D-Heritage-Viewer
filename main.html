<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>3D文物展示系统</title>
        <link rel="icon" type="image/png" href="favicon.png">
        <link rel="stylesheet" href="styles.css">

        <!-- Primary Meta Tags -->
        <meta name="title" content="3D文物展示系统">
        <meta name="description" content="使用手势和语音命令实时控制3D文物模型">

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:title" content="3D文物展示系统">
        <meta property="og:description" content="使用手势和语音命令实时控制3D文物模型">
        <meta property="og:image" content="assets/siteOGImage.jpg">

        <script type="importmap">
            {
                "imports": {
                    "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
                    "three/examples/": "https://unpkg.com/three@0.161.0/examples/jsm/",
                    "three/loaders/": "https://unpkg.com/three@0.161.0/examples/jsm/loaders/"
                }
            }
        </script>
    </head>
    <body style="width: 100%; height: 100%; overflow: hidden; margin: 0;">
        <div id="renderDiv" style="width: 100%; height: 100%; margin: 0;">            <div id="instruction-text" class="text-box"></div>
            <div id="back-link" class="text-box">
                <a href="gallery.html">返回展馆</a>
            </div>
            <div id="description-button" class="text-box">
                <button id="showDescriptionBtn">文本介绍</button>
            </div>
            <div id="description-card" class="description-card">
                <div class="description-header">
                    <h3 id="description-title">文物介绍</h3>
                    <button id="closeDescriptionCard">关闭</button>
                </div>
                <div id="description-content" class="description-content">
                    加载中...
                </div>
            </div>
            <div id="model-select-button" class="text-box">
                <button id="selectModelBtn">选择文物</button>
            </div>
            <div id="model-selection-card" class="model-selection-card">
                <h3>选择文物模型</h3>
                <div class="filter-section">
                    <div class="filter-group">
                        <label>朝代筛选：</label>
                        <button class="filter-btn active" data-filter-type="dynasty" data-filter-value="all">全部</button>
                        <button class="filter-btn" data-filter-type="dynasty" data-filter-value="清代">清代</button>
                        <button class="filter-btn" data-filter-type="dynasty" data-filter-value="唐代">唐代</button>
                        <button class="filter-btn" data-filter-type="dynasty" data-filter-value="夏商">夏商</button>
                        <button class="filter-btn" data-filter-type="dynasty" data-filter-value="未知">未知</button>
                    </div>
                    <div class="filter-group">
                        <label>类别筛选：</label>
                        <button class="filter-btn active" data-filter-type="category" data-filter-value="all">全部</button>
                        <button class="filter-btn" data-filter-type="category" data-filter-value="陶瓷器">陶瓷器</button>
                        <button class="filter-btn" data-filter-type="category" data-filter-value="雕塑">雕塑</button>
                        <button class="filter-btn" data-filter-type="category" data-filter-value="乐器">乐器</button>
                        <button class="filter-btn" data-filter-type="category" data-filter-value="青铜器">青铜器</button>
                    </div>
                </div>
                <div class="model-list">
                    <div class="model-item selected " data-model="teacup.gltf" data-dynasty="清代" data-category="陶瓷器">茶壶</div>
                    <div class="model-item " data-model="modelNew.gltf" data-dynasty="唐代" data-category="雕塑">乐舞俑</div>
                    <div class="model-item " data-model="egypt_djembe_drum.glb" data-dynasty="未知" data-category="乐器">埃及金贝鼓</div>
                    <div class="model-item " data-model="copper-chew.gltf" data-dynasty="夏商" data-category="青铜器">二里头文化青铜器</div>
                </div>
                <button id="closeModelCard">关闭</button>
            </div>
        </div>
        <script type="module" src="main.js"></script>
        <script type="module">
            // 模型选择功能
            document.addEventListener('DOMContentLoaded', function() {
                console.log("DOM内容已加载，设置模型选择功能...");
                
                const selectModelBtn = document.getElementById('selectModelBtn');
                const modelSelectionCard = document.getElementById('model-selection-card');
                const closeModelCard = document.getElementById('closeModelCard');
                const modelItems = document.querySelectorAll('.model-item');
                
                if (!selectModelBtn || !modelSelectionCard || !closeModelCard) {
                    console.error("未找到模型选择相关元素!");
                    return;
                }
                
                console.log("找到所有模型选择元素，设置事件处理...");
                
                // 初始状态隐藏模型选择卡片
                modelSelectionCard.style.display = 'none';
                
                // 点击"选择文物"按钮显示卡片
                selectModelBtn.addEventListener('click', function() {
                    console.log("点击了选择文物按钮");
                    modelSelectionCard.style.display = 'block';
                });
                
                // 点击"关闭"按钮隐藏卡片
                closeModelCard.addEventListener('click', function() {
                    console.log("点击了关闭按钮");
                    modelSelectionCard.style.display = 'none';
                });
                
                // 点击模型项选择模型
                modelItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const modelPath = this.getAttribute('data-model');
                        console.log("选择了模型:", modelPath);
                        
                        // 使用自定义事件通知game.js加载新模型
                        const event = new CustomEvent('loadNewModel', { 
                            detail: { modelPath: 'assets/' + modelPath }
                        });
                        window.dispatchEvent(event);
                        
                        // 高亮选中的模型
                        modelItems.forEach(m => m.classList.remove('selected'));
                        this.classList.add('selected');
                        
                        // 关闭模型选择卡片
                        modelSelectionCard.style.display = 'none';
                    });
                });

                // 过滤功能
                const filterBtns = document.querySelectorAll('.filter-btn');
                let currentDynastyFilter = 'all';
                let currentCategoryFilter = 'all';

                filterBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const filterType = this.getAttribute('data-filter-type');
                        const filterValue = this.getAttribute('data-filter-value');
                        
                        // 更新当前过滤器
                        if (filterType === 'dynasty') {
                            currentDynastyFilter = filterValue;
                            // 移除同类型按钮的active状态
                            document.querySelectorAll('.filter-btn[data-filter-type="dynasty"]').forEach(b => {
                                b.classList.remove('active');
                            });
                        } else if (filterType === 'category') {
                            currentCategoryFilter = filterValue;
                            // 移除同类型按钮的active状态
                            document.querySelectorAll('.filter-btn[data-filter-type="category"]').forEach(b => {
                                b.classList.remove('active');
                            });
                        }
                        
                        // 激活当前按钮
                        this.classList.add('active');
                        
                        // 应用过滤
                        applyFilters();
                    });
                });

                function applyFilters() {
                    modelItems.forEach(item => {
                        const itemDynasty = item.getAttribute('data-dynasty');
                        const itemCategory = item.getAttribute('data-category');
                        
                        const dynastyMatch = currentDynastyFilter === 'all' || itemDynasty === currentDynastyFilter;
                        const categoryMatch = currentCategoryFilter === 'all' || itemCategory === currentCategoryFilter;
                        
                        if (dynastyMatch && categoryMatch) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                }

                console.log("模型选择功能设置完成");
            });
        </script>
    </body>
</html>
